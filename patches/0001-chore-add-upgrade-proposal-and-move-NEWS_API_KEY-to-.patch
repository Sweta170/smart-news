From edad99c1b89269e3f79478c27722ee248cee1705 Mon Sep 17 00:00:00 2001
From: Sweta170 <swetarita17@gmail.com>
Date: Sun, 15 Feb 2026 00:13:06 +0530
Subject: [PATCH] chore: add upgrade proposal and move NEWS_API_KEY to expo
 extra

---
 README.md                   |  20 ++
 UPGRADE_PROPOSAL.md         |  50 +++++
 app.json                    |   3 +
 screens/HomeScreen/index.js | 393 +++++++++++++++++++++++++++++-------
 4 files changed, 394 insertions(+), 72 deletions(-)
 create mode 100644 UPGRADE_PROPOSAL.md

diff --git a/README.md b/README.md
index 21e565f..38168fd 100644
--- a/README.md
+++ b/README.md
@@ -4,3 +4,23 @@ Cryptocurrency news app in react native expo. Projects for native beginners
 [Full Documentation of the code is here](https://ninza7.medium.com/cryptocurrency-news-app-using-react-native-expo-and-newsapi-c3f96ca3be20)
 
 [Video Tutorial](https://youtu.be/yUEXP2ED2zg)
+
+## Setup: NewsAPI Key
+
+This project expects a NewsAPI key to be provided via Expo `extra` settings or an environment variable.
+
+- Add your key to `app.json` under `expo.extra.NEWS_API_KEY`:
+
+```json
+{
+	"expo": {
+		"extra": {
+			"NEWS_API_KEY": "YOUR_NEWSAPI_KEY_HERE"
+		}
+	}
+}
+```
+
+- Alternatively set `NEWS_API_KEY` in your environment or use EAS secrets for production builds.
+
+After adding the key restart the Expo server (`expo start`).
diff --git a/UPGRADE_PROPOSAL.md b/UPGRADE_PROPOSAL.md
new file mode 100644
index 0000000..e4bf7c8
--- /dev/null
+++ b/UPGRADE_PROPOSAL.md
@@ -0,0 +1,50 @@
+## Dependency Upgrade Proposal
+
+This document proposes safe, tested steps to upgrade the project's dependencies and notes compatibility considerations.
+
+Current notable packages (from `package.json`):
+
+- `expo`: ~42.0.1
+- `react`: 16.13.1
+- `react-native`: expo SDK 42 (react-native linked from expo)
+- `react-native-paper`: ^4.9.2
+- `react-native-linear-gradient`: ^2.8.3
+- `react-native-webview`: ^13.16.0
+
+Proposal summary
+
+1. Target an Expo SDK upgrade path rather than piecemeal package bumps. Recommended flow:
+   - Upgrade Expo to a recent SDK (e.g., SDK 45+) using `expo upgrade` (run locally).
+   - Address breaking changes in React and React Native introduced by the new SDK.
+
+2. Upgrade `react` to a compatible version for the chosen SDK (likely React 17 or 18).
+
+3. Update `react-native-paper` to latest v5+ (note: v5 may require React 17+ and react-native-vector-icons updates).
+
+4. Update `react-native-webview` and `react-native-linear-gradient` to their latest stable releases.
+
+5. Run the app in a fresh emulator and fix compile/runtime errors; update native modules if necessary.
+
+Detailed recommended commands (run locally):
+
+```bash
+# 1) Create branch (already done):
+git checkout -b upgrade/deps-proposal
+
+# 2) Upgrade Expo SDK interactively (recommended):
+npx expo-cli upgrade
+
+# 3) Install updated dependencies:
+yarn install
+
+# 4) Run app and fix issues:
+expo start
+```
+
+Notes & cautions
+
+- Upgrading Expo SDK is the canonical way to keep `react`/`react-native` in sync.
+- Do not manually bump `react-native` without using `expo upgrade` when using a managed Expo project.
+- Keep a backup branch and test on iOS and Android emulators/devices.
+
+If you want, I can attempt a safer automated change set (update `package.json` versions) and try to run the app here ‚Äî tell me whether you prefer a full upgrade attempt or just a prepared plan/PR.
diff --git a/app.json b/app.json
index 0e074c4..48d680d 100644
--- a/app.json
+++ b/app.json
@@ -16,6 +16,9 @@
     "assetBundlePatterns": [
       "**/*"
     ],
+    "extra": {
+      "NEWS_API_KEY": "" // Add your NewsAPI key here or set via environment/EAS secrets
+    },
     "ios": {
       "supportsTablet": true
     },
diff --git a/screens/HomeScreen/index.js b/screens/HomeScreen/index.js
index 9876ee1..40dfe1f 100644
--- a/screens/HomeScreen/index.js
+++ b/screens/HomeScreen/index.js
@@ -1,83 +1,332 @@
-import React, { Component } from 'react'
-import { View, Text, Image, ScrollView, Linking } from 'react-native'
-import axios from 'axios'
-import { Card, Title, Paragraph } from 'react-native-paper'
+import React, { Component } from "react";
+import { View, Text, Image, ScrollView, Linking, ActivityIndicator, TouchableOpacity, TextInput, RefreshControl, Animated } from "react-native";
+import AsyncStorage from '@react-native-async-storage/async-storage';
+import axios from "axios";
+import { Card, Title, Paragraph } from "react-native-paper";
+import Constants from 'expo-constants';
 
-import Header from '../../components/AppBar'
+import Header from "../../components/AppBar";
 
 export default class HomeScreen extends Component {
-    
-    state = {
-        articles: [],
-        isLoading: true,
-        errors: null
-    };
-
-    getArticles() {
-        axios
-          .get(
-            "https://newsapi.org/v2/everything?q=Cryptocurrency&from=2021-09-08&sortBy=popularity&apiKey=API_KEY"
-          )
-          .then(response =>
-            response.data.articles.map(article => ({
-              date: `${article.publishedAt}`,
-              title: `${article.title}`,
-              url: `${article.url}`,
-              description: `${article.description}`,
-              urlToImage: `${article.urlToImage}`,
-            }))
-          )
-          .then(articles => {
-            this.setState({
-              articles,
-              isLoading: false
-            });
-          })
-          .catch(error => this.setState({ error, isLoading: false }));
+
+  state = {
+    articles: [],
+    isLoading: true,
+    errors: null,
+    categories: [
+      "technology",
+      "business",
+      "sports",
+      "health",
+      "science",
+      "entertainment",
+      "general"
+    ],
+    selectedCategory: "technology",
+    searchQuery: "",
+    bookmarks: [],
+    refreshing: false
+  };
+
+  getArticles = async (category = this.state.selectedCategory, searchQuery = this.state.searchQuery, isRefresh = false) => {
+    if (isRefresh) {
+      this.setState({ refreshing: true, errors: null });
+    } else {
+      this.setState({ isLoading: true, errors: null });
     }
+    try {
+      const API_KEY = Constants.manifest?.extra?.NEWS_API_KEY || process.env.NEWS_API_KEY || '';
+      if (!API_KEY) {
+        console.warn('NEWS_API_KEY is not set. Add it to app.json -> expo.extra.NEWS_API_KEY or set NEWS_API_KEY in the environment.');
+      }
+      let url = `https://newsapi.org/v2/top-headlines?category=${category}&country=us&apiKey=${API_KEY}`;
+      if (searchQuery && searchQuery.trim().length > 0) {
+        url += `&q=${encodeURIComponent(searchQuery.trim())}`;
+      }
+      const res = await axios.get(url);
+
+      const articles = res.data.articles.map(article => ({
+        date: article.publishedAt,
+        title: article.title,
+        url: article.url,
+        description: article.description,
+        urlToImage: article.urlToImage,
+      }));
 
-    componentDidMount() {
-        this.getArticles();
+      this.setState({
+        articles,
+        isLoading: false,
+        refreshing: false
+      });
+
+    } catch (error) {
+      console.log("API ERROR:", error.response?.data || error.message);
+      this.setState({
+        errors: error,
+        isLoading: false,
+        refreshing: false
+      });
+      onRefresh = () => {
+        this.getArticles(this.state.selectedCategory, this.state.searchQuery, true);
+      };
     }
+  };
+
 
+  async componentDidMount() {
+    this.getArticles();
+    this.loadBookmarks();
+  }
 
-    render(){
-        const{ isLoading, articles } = this.state;
-        return (
-            <View>
-                <Header/>
-                <ScrollView>
-                    {!isLoading ? (
-                        articles.map(article => {
-                        const {date, title, url, description, urlToImage} = article;
-                        return(
-                            <Card key={url} style={{marginTop:10, borderColor:'black', borderRadius:5, borderBottomWidth:1}}
-                            onPress={()=>{Linking.openURL(`${url}`)}}
-                            >
-                                <View style={{flexDirection:'row',}}>
-                                    {/*  Text */}
-                                    <View style={{justifyContent:'space-around', flex:2/3, margin:10}}>
-                                        <Title>{title}</Title>
-                                    </View>
-                                    {/*  Image */}
-                                    <View style={{flex:1/3, margin:10}}>
-                                        <Image style={{width:120, height:120}} source={{uri: urlToImage}} />
-                                    </View>  
-                                </View>
-                                <View style={{margin:10}}>
-                                    <Paragraph>{description}</Paragraph>
-                                    <Text>Published At: {date}</Text>
-                                </View>
-                            </Card>
-                        );
-                    })
-                    ) : (
-                    <Text style={{justifyContent:'center', alignItems:'center'}}>Loading...</Text>
-                    )}
-                </ScrollView>
-            </View>
-        )
+  loadBookmarks = async () => {
+    try {
+      const bookmarks = await AsyncStorage.getItem('bookmarkedArticles');
+      if (bookmarks) {
+        this.setState({ bookmarks: JSON.parse(bookmarks) });
+      }
+    } catch (e) {
+      // ignore errors
     }
-}
+  };
+
+  saveBookmarks = async (bookmarks) => {
+    try {
+      await AsyncStorage.setItem('bookmarkedArticles', JSON.stringify(bookmarks));
+    } catch (e) {
+      // ignore errors
+    }
+  };
+
+  isBookmarked = (url) => {
+    return this.state.bookmarks.some(article => article.url === url);
+  };
+
+  toggleBookmark = (article) => {
+    let bookmarks = [...this.state.bookmarks];
+    const index = bookmarks.findIndex(a => a.url === article.url);
+    if (index > -1) {
+      bookmarks.splice(index, 1);
+    } else {
+      bookmarks.push(article);
+    }
+    this.setState({ bookmarks }, () => this.saveBookmarks(bookmarks));
+  };
+
+  handleCategorySelect = (category) => {
+    if (category !== this.state.selectedCategory) {
+      this.setState({ selectedCategory: category }, () => {
+        this.getArticles(category, this.state.searchQuery);
+      });
+    }
+  };
+
+  handleSearchChange = (text) => {
+    this.setState({ searchQuery: text });
+  };
+
+  handleSearchSubmit = () => {
+    this.getArticles(this.state.selectedCategory, this.state.searchQuery);
+  };
+
+  openLink = (url) => {
+    if (url) {
+      Linking.openURL(url);
+    }
+  };
+
+  render() {
 
+    const { isLoading, articles, errors, categories, selectedCategory, searchQuery, bookmarks } = this.state;
+    const { theme, isDark, onToggleTheme } = this.props;
+    return (
+      <View style={{ flex: 1, backgroundColor: theme.background }}>
+        <Header theme={theme} isDark={isDark} onToggleTheme={onToggleTheme} />
 
+        {/* Search Bar */}
+        <View style={{
+          flexDirection: 'row',
+          alignItems: 'center',
+          marginHorizontal: 18,
+          marginTop: 18,
+          marginBottom: 0,
+          backgroundColor: theme.searchBg,
+          borderRadius: 24,
+          borderWidth: 1,
+          borderColor: theme.searchBorder,
+          paddingHorizontal: 10,
+          paddingVertical: 2,
+        }}>
+          <TouchableOpacity
+            onPress={this.handleSearchSubmit}
+            style={{ padding: 6, marginRight: 4 }}
+            accessibilityLabel="Search"
+          >
+            <Text style={{ fontSize: 20, color: theme.textSecondary }}>üîç</Text>
+          </TouchableOpacity>
+          <TextInput
+            style={{
+              flex: 1,
+              backgroundColor: 'transparent',
+              borderRadius: 24,
+              paddingHorizontal: 8,
+              paddingVertical: 10,
+              fontSize: 16,
+              color: theme.text,
+              borderWidth: 0,
+            }}
+            placeholder="Search news..."
+            placeholderTextColor={theme.textSecondary}
+            value={searchQuery}
+            onChangeText={this.handleSearchChange}
+            onSubmitEditing={this.handleSearchSubmit}
+            returnKeyType="search"
+          />
+        </View>
+
+        {/* Category Selector */}
+        <ScrollView horizontal showsHorizontalScrollIndicator={false} style={{ marginVertical: 18, paddingHorizontal: 10 }}>
+          {categories.map((cat) => {
+            const isActive = selectedCategory === cat;
+            return (
+              <Animated.View
+                key={cat}
+                style={{
+                  transform: [{ scale: isActive ? 1.08 : 1 }],
+                  marginRight: 14,
+                }}
+              >
+                <TouchableOpacity
+                  onPress={() => this.handleCategorySelect(cat)}
+                  activeOpacity={0.85}
+                  style={{
+                    backgroundColor: isActive ? theme.primary : 'transparent',
+                    paddingVertical: 8,
+                    paddingHorizontal: 22,
+                    borderRadius: 22,
+                    borderWidth: 2,
+                    borderColor: isActive ? theme.primary : theme.pill,
+                    minWidth: 80,
+                    alignItems: 'center',
+                    justifyContent: 'center',
+                    marginBottom: 2,
+                  }}
+                >
+                  <Text style={{
+                    color: isActive ? '#fff' : theme.textSecondary,
+                    fontWeight: isActive ? '700' : '500',
+                    textTransform: 'capitalize',
+                    fontSize: 15,
+                    letterSpacing: 0.5,
+                  }}>{cat}</Text>
+                </TouchableOpacity>
+              </Animated.View>
+            );
+          })}
+        </ScrollView>
+
+        {isLoading && (
+          <ActivityIndicator size="large" style={{ marginTop: 32 }} color={theme.primary} />
+        )}
+
+        {errors && (
+          <Text style={{ color: "red", textAlign: "center", marginTop: 18, fontSize: 15, fontWeight: '500' }}>
+            Failed to load news
+          </Text>
+        )}
+
+        <ScrollView
+          refreshControl={
+            <RefreshControl
+              refreshing={this.state.refreshing}
+              onRefresh={this.onRefresh}
+              colors={[theme.primary]}
+            />
+          }
+        >
+          {!isLoading &&
+            articles.map((article, index) => {
+              const { date, title, url, description, urlToImage } = article;
+
+              return (
+                <Card
+                  key={url || index}
+                  style={{
+                    marginHorizontal: 10,
+                    marginVertical: 18,
+                    borderRadius: 22,
+                    borderWidth: 0,
+                    backgroundColor: theme.card,
+                    shadowColor: theme.shadow,
+                    shadowOffset: { width: 0, height: 6 },
+                    shadowOpacity: 0.10,
+                    shadowRadius: 12,
+                    elevation: 6,
+                    padding: 0,
+                    overflow: 'hidden',
+                  }}
+                  onPress={() => this.openLink(url)}
+                  activeOpacity={0.95}
+                >
+                  {/* Image at the top, full width, aspect ratio 16:9 */}
+                  <View style={{ width: '100%', aspectRatio: 16/9, backgroundColor: theme.pill }}>
+                    <Image
+                      style={{ width: '100%', height: '100%', borderTopLeftRadius: 22, borderTopRightRadius: 22 }}
+                      source={{ uri: (urlToImage && urlToImage.startsWith('http')) ? urlToImage : 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80' }}
+                      resizeMode="cover"
+                      onError={(e) => { /* fallback to placeholder if image fails to load */ }}
+                    />
+                  </View>
+                  {/* Card content below image */}
+                  <View style={{ paddingHorizontal: 22, paddingTop: 18, paddingBottom: 10, backgroundColor: theme.card }}>
+                    <View style={{ flexDirection: 'row', alignItems: 'flex-start', justifyContent: 'space-between' }}>
+                      <Text style={{ fontFamily: theme.serifFont, fontSize: 38, color: theme.text, fontWeight: 'bold', marginRight: 10, marginTop: -2 }}>S<Text style={{ color: theme.primary, fontSize: 32 }}>.</Text></Text>
+                      <View style={{ flexDirection: 'row', alignItems: 'center' }}>
+                        <Text style={{
+                          backgroundColor: theme.primary,
+                          color: '#fff',
+                          borderRadius: 16,
+                          paddingHorizontal: 14,
+                          paddingVertical: 4,
+                          fontSize: 14,
+                          fontWeight: '600',
+                          marginLeft: 0,
+                        }}>News</Text>
+                      </View>
+                    </View>
+                    <Title numberOfLines={2} style={{ fontFamily: theme.serifFont, fontSize: 22, color: theme.text, fontWeight: '700', marginTop: 10, marginBottom: 6, letterSpacing: 0.2 }}>{title}</Title>
+                    <Text style={{ color: theme.textSecondary, fontSize: 13, marginTop: 0, letterSpacing: 0.1 }}>{date ? date.split('T')[0] : ''}</Text>
+                  </View>
+                  {/* Tag row (example tags) */}
+                  <View style={{ flexDirection: 'row', flexWrap: 'wrap', gap: 8, paddingHorizontal: 18, paddingTop: 0, paddingBottom: 16, backgroundColor: theme.card }}>
+                    {/* Example tags, replace with dynamic tags if available */}
+                    <Text style={{
+                      backgroundColor: theme.primary,
+                      color: '#fff',
+                      borderRadius: 16,
+                      paddingHorizontal: 14,
+                      paddingVertical: 4,
+                      fontSize: 14,
+                      fontWeight: '600',
+                      marginRight: 8,
+                      marginBottom: 4,
+                    }}>Insights</Text>
+                    <Text style={{
+                      backgroundColor: theme.pill,
+                      color: theme.textSecondary,
+                      borderRadius: 16,
+                      paddingHorizontal: 14,
+                      paddingVertical: 4,
+                      fontSize: 14,
+                      fontWeight: '600',
+                      marginRight: 8,
+                      marginBottom: 4,
+                    }}>People</Text>
+                  </View>
+                </Card>
+              );
+            })}
+        </ScrollView>
+      </View>
+    );
+  }
+}
-- 
2.45.1.windows.1

